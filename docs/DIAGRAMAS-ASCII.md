# Diagramas ASCII - CondoAI

Diagramas prontos em ASCII para referência rápida ao criar o desenho no Excalidraw.

---

## 🔐 FLUXO COMPLETO DE LOGIN

```
┌─────────────────────────────────────────────────────────────────┐
│                         USUÁRIO                                 │
│                    (Acessa /login)                              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                    TELA DE LOGIN                                │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐               │
│  │   Email    │  │   Senha    │  │ Nome (opt) │               │
│  └────────────┘  └────────────┘  └────────────┘               │
│  [Entrar] ou [Criar Conta]                                     │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                      AUTHCONTEXT                                │
│  • signIn(email, password)                                      │
│  • signUp(email, password, name)                                │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                    SUPABASE AUTH                                │
│  • auth.signInWithPassword()                                    │
│  • auth.signUp()                                                │
│  • Valida credenciais                                           │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                  ◆ CREDENCIAIS VÁLIDAS? ◆                       │
└───────────┬─────────────────────────────────────┬───────────────┘
           NÃO                                    SIM
            │                                      │
            ↓                                      ↓
    ┌──────────────┐                    ┌──────────────────────┐
    │ Retorna Erro │                    │ ensureUserExists()   │
    │ para Login   │                    │ fetchUserData()      │
    └──────────────┘                    └──────────┬───────────┘
                                                   │
                                                   ↓
                                        ┌──────────────────────┐
                                        │  TABELA: users       │
                                        │  ┌────────────────┐  │
                                        │  │ SELECT ou      │  │
                                        │  │ INSERT user    │  │
                                        │  └────────────────┘  │
                                        │                      │
                                        │ Retorna:             │
                                        │  • id                │
                                        │  • email             │
                                        │  • display_name      │
                                        │  • subscription_     │
                                        │    status            │
                                        │  • risk_profile      │
                                        └──────────┬───────────┘
                                                   │
                                                   ↓
                                        ┌──────────────────────┐
                                        │   AUTHCONTEXT        │
                                        │ Salva user no state  │
                                        └──────────┬───────────┘
                                                   │
                                                   ↓
                                        ┌──────────────────────┐
                                        │   /dashboard         │
                                        │  (Redirecionamento)  │
                                        └──────────────────────┘
```

---

## 📊 FLUXO COMPLETO DO DASHBOARD

```
┌─────────────────────────────────────────────────────────────────┐
│                      DASHBOARD PAGE                             │
│              useEffect(() => loadInvestments())                 │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                  TABELA: investments                            │
│  ┌──────────────────────────────────────────────────────┐      │
│  │ SELECT * FROM investments WHERE user_id = ?          │      │
│  └──────────────────────────────────────────────────────┘      │
│                                                                 │
│  Retorna array:                                                 │
│  [                                                              │
│    { id, ticker, type, quantidade, preco_medio, ... },         │
│    { id, ticker, type, quantidade, preco_medio, ... }          │
│  ]                                                              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
                ┌───────────────────────┐
                │  Para cada investment │
                └───────────┬───────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│              API ROUTE: /api/quotes/[ticker]                    │
│                   fetch(`/api/quotes/${ticker}`)                │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                       BRAPI API                                 │
│        GET https://brapi.dev/api/quote/${ticker}                │
│                                                                 │
│  Retorna:                                                       │
│  {                                                              │
│    price: 28.50,                                                │
│    change: 1.23,                                                │
│    ...                                                          │
│  }                                                              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                   CÁLCULOS (Client-side)                        │
│                                                                 │
│  Para cada investimento:                                        │
│  • valorAtual = price × quantidade                              │
│                                                                 │
│  Resumo geral:                                                  │
│  • totalInvestido = Σ valor_total                               │
│  • valorTotal = Σ valorAtual                                    │
│  • lucroOuPrejuizo = valorTotal - totalInvestido                │
│  • percentualRetorno = (lucro / totalInvestido) × 100           │
│  • numeroInvestimentos = investments.length                     │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                    DASHBOARD PAGE                               │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              CARDS DE RESUMO                            │   │
│  │  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐  │   │
│  │  │  Valor   │ │  Total   │ │  Lucro/  │ │   Nº     │  │   │
│  │  │  Total   │ │Investido │ │ Prejuízo │ │ Invest.  │  │   │
│  │  └──────────┘ └──────────┘ └──────────┘ └──────────┘  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │            GRÁFICO DE PIZZA                             │   │
│  │         (Distribuição por tipo)                         │   │
│  │                                                         │   │
│  │         🥧 Ações: 40%                                   │   │
│  │         🥧 Fundos: 30%                                  │   │
│  │         🥧 Renda Fixa: 30%                              │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │        INVESTIMENTOS RECENTES (5 últimos)               │   │
│  │  • PETR4 - Petrobras - R$ 1.000,00                     │   │
│  │  • VALE3 - Vale - R$ 2.000,00                           │   │
│  │  • ...                                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 💼 FLUXO COMPLETO DE INVESTIMENTOS

```
┌─────────────────────────────────────────────────────────────────┐
│                  PÁGINA INVESTIMENTOS                           │
│             useEffect(() => loadAssets())                       │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                ◆ USER TEM RISK_PROFILE? ◆                       │
└───────────┬─────────────────────────────────────┬───────────────┘
           NÃO                                    SIM
            │                                      │
            ↓                                      ↓
    ┌──────────────────┐                ┌──────────────────┐
    │ Usa 'conservador'│                │ Usa perfil       │
    │ como padrão      │                │ do usuário       │
    │ + Mostra banner  │                └────────┬─────────┘
    └────────┬─────────┘                         │
             │                                    │
             └─────────────┬──────────────────────┘
                           │
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│            getAvailableInvestmentTypes(profile)                 │
│                                                                 │
│  Conservador → ['rendaFixa']                                    │
│  Moderado    → ['rendaFixa', 'fundo', 'acao']                   │
│  Arrojado    → ['rendaFixa', 'fundo', 'acao', 'cripto']         │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                    BUSCA ATIVOS                                 │
│                                                                 │
│  ┌──────────────────────────────────────┐                      │
│  │         BRAPI API                    │                      │
│  │  GET /api/quote/list                 │                      │
│  │  → Lista de ações da B3              │                      │
│  └──────────────────────────────────────┘                      │
│                                                                 │
│  ┌──────────────────────────────────────┐                      │
│  │      DADOS LOCAIS (mockados)         │                      │
│  │  → Fundos, Renda Fixa, Cripto        │                      │
│  └──────────────────────────────────────┘                      │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                 FILTRA ATIVOS POR PERFIL                        │
│  Mantém apenas ativos do tipo permitido pelo perfil            │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                PÁGINA INVESTIMENTOS                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              GRID DE CARDS DE ATIVOS                    │   │
│  │  ┌────────┐  ┌────────┐  ┌────────┐  ┌────────┐       │   │
│  │  │ PETR4  │  │ VALE3  │  │ ITUB4  │  │ BBDC4  │       │   │
│  │  │ R$28.50│  │ R$65.20│  │ R$25.80│  │ R$18.90│       │   │
│  │  │[Investir]│  │[Investir]│  │[Investir]│  │[Investir]│       │   │
│  │  └────────┘  └────────┘  └────────┘  └────────┘       │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
           (Usuário clica "Investir")
                      │
                      ↓
┌─────────────────────────────────────────────────────────────────┐
│                  MODAL DE INVESTIMENTO                          │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  Ativo: PETR4 - Petrobras                               │   │
│  │  Preço: R$ 28,50                                        │   │
│  │                                                         │   │
│  │  Quantidade: [____10____]                               │   │
│  │                                                         │   │
│  │  Total a Investir: R$ 285,00                            │   │
│  │                                                         │   │
│  │  [Cancelar]  [Confirmar Investimento]                   │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
         (Usuário confirma)
                      │
                      ↓
┌─────────────────────────────────────────────────────────────────┐
│                  TABELA: investments                            │
│  ┌──────────────────────────────────────────────────────┐      │
│  │ INSERT INTO investments (                            │      │
│  │   user_id,                                           │      │
│  │   type,                                              │      │
│  │   ticker,                                            │      │
│  │   nome,                                              │      │
│  │   quantidade,                                        │      │
│  │   preco_medio,                                       │      │
│  │   data_compra,                                       │      │
│  │   valor_total                                        │      │
│  │ ) VALUES (                                           │      │
│  │   'user-uuid',                                       │      │
│  │   'acao',                                            │      │
│  │   'PETR4',                                           │      │
│  │   'Petrobras',                                       │      │
│  │   10,                                                │      │
│  │   28.50,                                             │      │
│  │   NOW(),                                             │      │
│  │   285.00                                             │      │
│  │ )                                                    │      │
│  └──────────────────────────────────────────────────────┘      │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                PÁGINA INVESTIMENTOS                             │
│  ✅ Investimento em PETR4 realizado com sucesso!                │
│  (Fecha modal)                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 👤 FLUXO COMPLETO DE PERFIL

```
┌─────────────────────────────────────────────────────────────────┐
│                    PÁGINA PERFIL                                │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│              ◆ USER JÁ TEM RISK_PROFILE? ◆                      │
└───────────┬─────────────────────────────────────┬───────────────┘
           SIM                                    NÃO
            │                                      │
            ↓                                      ↓
    ┌──────────────────┐                ┌──────────────────┐
    │ Mostra perfil    │                │ Mostra           │
    │ atual +          │                │ questionário     │
    │ [Refazer Quiz]   │                └────────┬─────────┘
    └──────────────────┘                         │
                                                 │
                                                 ↓
                                      ┌────────────────────┐
                                      │   QUESTIONÁRIO     │
                                      │   (5 perguntas)    │
                                      └────────┬───────────┘
                                               │
        ┌──────────────────────────────────────┼──────────────────────┐
        │                                      │                      │
        ↓                                      ↓                      ↓
┌───────────────┐                   ┌──────────────────┐   ┌─────────────────┐
│ PERGUNTA 1    │                   │  PERGUNTA 2      │   │   PERGUNTA 3    │
│ Objetivo com  │                   │  Reação a        │   │   Conhecimento  │
│ investimentos │                   │  perdas          │   │   sobre invest. │
│               │                   │                  │   │                 │
│ • Preservar   │                   │ • Venderia tudo  │   │ • Básico (1)    │
│   (score: 1)  │                   │   (score: 1)     │   │ • Intermediário │
│ • Crescer     │                   │ • Aguardaria     │   │   (score: 2)    │
│   (score: 2)  │                   │   (score: 2)     │   │ • Avançado (3)  │
│ • Maximizar   │                   │ • Compraria +    │   │                 │
│   (score: 3)  │                   │   (score: 3)     │   │                 │
└───────────────┘                   └──────────────────┘   └─────────────────┘

        ↓                                      ↓                      ↓
┌───────────────┐                   ┌──────────────────┐
│ PERGUNTA 4    │                   │  PERGUNTA 5      │
│ Prazo dos     │                   │  % patrimônio    │
│ investimentos │                   │  em ações        │
│               │                   │                  │
│ • Curto (1)   │                   │ • Até 20% (1)    │
│ • Médio (2)   │                   │ • 20-50% (2)     │
│ • Longo (3)   │                   │ • +50% (3)       │
└───────────────┘                   └──────────────────┘
        │                                      │
        └──────────────────┬───────────────────┘
                           │
                (Última pergunta respondida)
                           │
                           ↓
┌─────────────────────────────────────────────────────────────────┐
│              calculateAndSaveResult(answers)                    │
│                                                                 │
│  Exemplo: scores = [2, 2, 1, 3, 2]                             │
│                                                                 │
│  Calcula média:                                                 │
│  average = (2 + 2 + 1 + 3 + 2) / 5 = 2.0                       │
│                                                                 │
│  Define perfil:                                                 │
│  • average ≤ 1.5  → 'conservador'                               │
│  • 1.5 < average ≤ 2.5  → 'moderado' ✓                          │
│  • average > 2.5  → 'arrojado'                                  │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                  TABELA: users                                  │
│  ┌──────────────────────────────────────────────────────┐      │
│  │ UPDATE users                                         │      │
│  │ SET                                                  │      │
│  │   risk_profile = 'moderado',                         │      │
│  │   updated_at = NOW()                                 │      │
│  │ WHERE                                                │      │
│  │   id = 'user-uuid'                                   │      │
│  └──────────────────────────────────────────────────────┘      │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                   AUTHCONTEXT                                   │
│               refreshUser()                                     │
│  Atualiza user.riskProfile no state global                     │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                    PÁGINA PERFIL                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │           RESULTADO DO PERFIL                           │   │
│  │                                                         │   │
│  │  📊 Seu perfil: MODERADO                                │   │
│  │                                                         │   │
│  │  Você busca equilíbrio entre segurança e               │   │
│  │  rentabilidade, aceitando riscos moderados.            │   │
│  │                                                         │   │
│  │  Investimentos Recomendados:                            │   │
│  │  ✅ Fundos Multimercado                                 │   │
│  │  ✅ Ações de empresas consolidadas                      │   │
│  │  ✅ Fundos Imobiliários                                 │   │
│  │  ✅ Renda fixa + Renda variável                         │   │
│  │                                                         │   │
│  │  [Ver Investimentos Recomendados]  [Refazer Quiz]      │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 💰 FLUXO COMPLETO DE DIVIDENDOS

```
┌─────────────────────────────────────────────────────────────────┐
│                   PÁGINA DIVIDENDOS                             │
│            useEffect(() => loadDividends())                     │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                  TABELA: investments                            │
│  ┌──────────────────────────────────────────────────────┐      │
│  │ SELECT * FROM investments                            │      │
│  │ WHERE user_id = ? AND type = 'acao'                  │      │
│  └──────────────────────────────────────────────────────┘      │
│                                                                 │
│  Retorna apenas AÇÕES:                                          │
│  [                                                              │
│    { ticker: 'PETR4', quantidade: 10, data_compra: ... },      │
│    { ticker: 'VALE3', quantidade: 5, data_compra: ... }        │
│  ]                                                              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
                ┌───────────────────────┐
                │  Para cada ação       │
                └───────────┬───────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│            API ROUTE: /api/dividends/[ticker]                   │
│              fetch(`/api/dividends/${ticker}`)                  │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                       BRAPI API                                 │
│      GET https://brapi.dev/api/quote/${ticker}/dividends        │
│                                                                 │
│  Retorna:                                                       │
│  {                                                              │
│    dividends: [                                                 │
│      { date: '2024-01-15', value: 0.50, type: 'cash' },       │
│      { date: '2024-04-15', value: 0.45, type: 'cash' },       │
│      { date: '2024-07-15', value: 0.52, type: 'cash' },       │
│      { date: '2024-10-15', value: 0.48, type: 'cash' }        │
│    ],                                                           │
│    summary: {                                                   │
│      dividendYield: 5.2                                         │
│    }                                                            │
│  }                                                              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                 FILTRA E PROCESSA DIVIDENDOS                    │
│                                                                 │
│  1. Filtra type = 'cash' (dividendos em dinheiro)               │
│  2. Filtra últimos 12 meses                                     │
│  3. Separa recebidos vs não recebidos:                          │
│                                                                 │
│     ┌─────────────────────────────────────────┐                │
│     │  Se divDate >= dataCompra do usuário   │                │
│     │  → RECEBIDO ✓                           │                │
│     │                                         │                │
│     │  Se divDate < dataCompra                │                │
│     │  → NÃO RECEBIDO (pago antes da compra) │                │
│     └─────────────────────────────────────────┘                │
│                                                                 │
│  4. Calcula totalRecebido:                                      │
│     totalRecebido = Σ (valor × quantidade) [apenas recebidos]   │
│                                                                 │
│  Exemplo para PETR4 (10 ações, compra em 01/03/2024):          │
│  • 15/01/24: 0.50 × 10 = 5.00 (NÃO recebeu - antes da compra)  │
│  • 15/04/24: 0.45 × 10 = 4.50 (RECEBEU ✓)                      │
│  • 15/07/24: 0.52 × 10 = 5.20 (RECEBEU ✓)                      │
│  • 15/10/24: 0.48 × 10 = 4.80 (RECEBEU ✓)                      │
│  → Total recebido: R$ 14,50                                     │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                   PÁGINA DIVIDENDOS                             │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              CARDS DE RESUMO                            │   │
│  │  ┌────────────┐ ┌────────────┐ ┌────────────┐         │   │
│  │  │  Total     │ │ Pagamentos │ │ Yield      │         │   │
│  │  │  Recebido  │ │            │ │ Médio      │         │   │
│  │  │ R$ 14,50   │ │     3      │ │   5,2%     │         │   │
│  │  └────────────┘ └────────────┘ └────────────┘         │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │        HISTÓRICO DETALHADO (Tabela)                     │   │
│  │                                                         │   │
│  │  Data      | Ativo | Valor/Cota | Cotas | Recebeu     │   │
│  │  ──────────┼───────┼────────────┼───────┼───────────  │   │
│  │  15/10/24  | PETR4 |   R$ 0,48  |  10   | R$ 4,80 ✓   │   │
│  │  15/07/24  | PETR4 |   R$ 0,52  |  10   | R$ 5,20 ✓   │   │
│  │  15/04/24  | PETR4 |   R$ 0,45  |  10   | R$ 4,50 ✓   │   │
│  │  15/01/24  | PETR4 |   R$ 0,50  |  10   | R̶$̶ ̶5̶,̶0̶0̶    │   │
│  │            |       |            |       | (Não recebeu)   │
│  │                                                         │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📰 FLUXO COMPLETO DE NOTÍCIAS

```
┌─────────────────────────────────────────────────────────────────┐
│                    PÁGINA NOTÍCIAS                              │
│              useEffect(() => loadNews())                        │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│              ◆ USUÁRIO AUTENTICADO? ◆                           │
└───────────┬─────────────────────────────────────┬───────────────┘
           NÃO                                    SIM
            │                                      │
            ↓                                      ↓
    ┌──────────────┐                    ┌──────────────────┐
    │ Redireciona  │                    │ Carrega notícias │
    │ para /login  │                    └────────┬─────────┘
    └──────────────┘                             │
                                                 ↓
                                      ┌──────────────────────┐
                                      │ API ROUTE: /api/news │
                                      │  fetch('/api/news')  │
                                      └──────────┬───────────┘
                                                 │
                                                 ↓
┌─────────────────────────────────────────────────────────────────┐
│                  BUSCA MÚLTIPLOS FEEDS RSS                      │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Feed 1: InfoMoney - Mercados                            │  │
│  │  https://www.infomoney.com.br/mercados/feed/             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Feed 2: InfoMoney - Investimentos                       │  │
│  │  https://www.infomoney.com.br/onde-investir/feed/        │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  Feed 3: Valor Econômico - Finanças                      │  │
│  │  https://valor.globo.com/financas/rss                    │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  Parser RSS extrai de cada feed (até 10 itens):                │
│  • title                                                        │
│  • link                                                         │
│  • pubDate                                                      │
│  • contentSnippet                                               │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│              FILTRAGEM DE NOTÍCIAS RELEVANTES                   │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ETAPA 1: Verificar palavras IRRELEVANTES               │  │
│  │  Se contém: futebol, esporte, novela, celebridade...    │  │
│  │  → EXCLUIR notícia                                       │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │  ETAPA 2: Verificar palavras RELEVANTES                 │  │
│  │  Se contém: bolsa, ações, ibovespa, investimento,       │  │
│  │  dividendo, mercado, cotação, dólar, juros, selic...    │  │
│  │  → INCLUIR notícia                                       │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│  Exemplo de filtragem:                                          │
│  ✅ "Ibovespa sobe 2% com alta de Petrobras"                    │
│  ✅ "Tesouro Direto: veja as taxas desta semana"                │
│  ✅ "Vale distribui R$ 1,2 bi em dividendos"                    │
│  ❌ "Time vence campeonato de futebol"                          │
│  ❌ "Celebridade anuncia novo filme"                            │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│               PROCESSAMENTO FINAL                               │
│                                                                 │
│  1. Ordenar por data (mais recentes primeiro)                   │
│  2. Remover duplicatas (comparando títulos)                     │
│  3. Limitar a 10 notícias                                       │
│                                                                 │
│  Resultado:                                                     │
│  {                                                              │
│    news: [                                                      │
│      {                                                          │
│        title: "Ibovespa fecha em alta de 1,8%...",            │
│        link: "https://...",                                     │
│        pubDate: "2024-12-01T18:00:00Z",                        │
│        source: "InfoMoney"                                      │
│      },                                                         │
│      {                                                          │
│        title: "Dólar cai para R$ 5,85...",                     │
│        link: "https://...",                                     │
│        pubDate: "2024-12-01T17:30:00Z",                        │
│        source: "Valor Econômico"                                │
│      },                                                         │
│      ... (até 10 notícias)                                      │
│    ],                                                           │
│    lastUpdate: "2024-12-01T18:05:00Z"                          │
│  }                                                              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                    PÁGINA NOTÍCIAS                              │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              LISTA DE NOTÍCIAS                          │   │
│  │                                                         │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │ 📰 Ibovespa fecha em alta de 1,8%...           │   │   │
│  │  │ Fonte: InfoMoney • Há 5 minutos                 │   │   │
│  │  │ [Ler mais →]                                    │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                                                         │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │ 💰 Dólar cai para R$ 5,85 com fluxo...         │   │   │
│  │  │ Fonte: Valor Econômico • Há 35 minutos          │   │   │
│  │  │ [Ler mais →]                                    │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                                                         │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │ 📊 Vale anuncia dividendos de R$ 1,2 bi...     │   │   │
│  │  │ Fonte: InfoMoney • Há 1 hora                    │   │   │
│  │  │ [Ler mais →]                                    │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                                                         │   │
│  │  ... (até 10 notícias)                                  │   │
│  │                                                         │   │
│  │  Última atualização: Há 5 minutos                       │   │
│  │  [🔄 Atualizar Notícias]                                │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
```

---

## 💳 FLUXO COMPLETO DE PAGAMENTO STRIPE

```
┌─────────────────────────────────────────────────────────────────┐
│                     PÁGINA PLANOS                               │
│                    (Usuário acessa /planos)                     │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│              ◆ USUÁRIO AUTENTICADO? ◆                           │
└───────────┬─────────────────────────────────────┬───────────────┘
           NÃO                                    SIM
            │                                      │
            ↓                                      ↓
    ┌──────────────┐                    ┌──────────────────┐
    │ Redireciona  │                    │ Carrega planos   │
    │ para /login  │                    └────────┬─────────┘
    └──────────────┘                             │
                                                 ↓
┌─────────────────────────────────────────────────────────────────┐
│                    PÁGINA PLANOS                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │           PLANO GRATUITO          │    PLANO PRO 💎    │   │
│  │         R$ 0,00/mês               │  R$ 29,90/mês      │   │
│  │                                   │                    │   │
│  │  ✅ Dashboard                     │  ✅ Tudo do Free   │   │
│  │  ✅ Até 5 investimentos           │  ✅ Investimentos  │   │
│  │  ✅ Perfil investidor             │     Ilimitados     │   │
│  │  ❌ Contato com gestora           │  ✅ Contato com    │   │
│  │  ❌ Suporte prioritário           │     gestora        │   │
│  │                                   │  ✅ Agendamento    │   │
│  │  [Plano Atual]                    │  ✅ Suporte        │   │
│  │                                   │     prioritário    │   │
│  │                                   │                    │   │
│  │                                   │  [Assinar Agora]   │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
           (Usuário clica "Assinar Agora")
                      │
                      ↓
┌─────────────────────────────────────────────────────────────────┐
│       API ROUTE: /api/stripe/create-checkout-session           │
│            POST { userId, email }                               │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                 STRIPE: Buscar/Criar Customer                   │
│                                                                 │
│  1. Busca customer existente por email                          │
│     stripe.customers.list({ email })                            │
│                                                                 │
│  ┌──────────────────────────────────────┐                      │
│  │ ◆ Customer já existe? ◆              │                      │
│  └───────┬──────────────────────┬───────┘                      │
│         SIM                     NÃO                             │
│          │                       │                              │
│          ↓                       ↓                              │
│  ┌──────────────┐      ┌──────────────────┐                   │
│  │ Usa customer │      │ Cria novo:       │                   │
│  │ existente    │      │ stripe.customers │                   │
│  │              │      │ .create({        │                   │
│  │              │      │   email,         │                   │
│  │              │      │   metadata: {    │                   │
│  │              │      │     supabaseUID  │                   │
│  │              │      │   }              │                   │
│  │              │      │ })               │                   │
│  └──────────────┘      └──────────────────┘                   │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│              STRIPE: Criar Sessão de Checkout                   │
│                                                                 │
│  stripe.checkout.sessions.create({                              │
│    customer: customer.id,                                       │
│    payment_method_types: ['card'],                              │
│    line_items: [{                                               │
│      price: process.env.STRIPE_PRICE_ID, // PRO R$ 29,90      │
│      quantity: 1                                                │
│    }],                                                          │
│    mode: 'subscription',                                        │
│    success_url: '/planos/sucesso?session_id={CHECKOUT...}',    │
│    cancel_url: '/planos',                                       │
│    metadata: {                                                  │
│      supabaseUID: userId                                        │
│    }                                                            │
│  })                                                             │
│                                                                 │
│  Retorna: { url: 'https://checkout.stripe.com/...' }          │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                   REDIRECIONAMENTO                              │
│          window.location.href = session.url                     │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                STRIPE CHECKOUT PAGE                             │
│            (checkout.stripe.com)                                │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │           Finalize sua assinatura                       │   │
│  │                                                         │   │
│  │  Email: usuario@email.com                               │   │
│  │                                                         │   │
│  │  Plano PRO - R$ 29,90/mês                               │   │
│  │                                                         │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │ Número do cartão                                │   │   │
│  │  │ [__________________]                            │   │   │
│  │  │                                                 │   │   │
│  │  │ Validade      CVV                               │   │   │
│  │  │ [MM/AA]      [___]                              │   │   │
│  │  │                                                 │   │   │
│  │  │ Nome no cartão                                  │   │   │
│  │  │ [__________________]                            │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                                                         │   │
│  │  [Assinar PRO - R$ 29,90/mês]                           │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
         (Usuário confirma pagamento)
                      │
                      ↓
┌─────────────────────────────────────────────────────────────────┐
│              STRIPE: Processa Pagamento                         │
│                                                                 │
│  1. Valida dados do cartão                                      │
│  2. Cria subscription                                           │
│  3. Cobra primeira mensalidade (R$ 29,90)                       │
│  4. Ativa subscription                                          │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│               ◆ PAGAMENTO APROVADO? ◆                           │
└───────────┬─────────────────────────────────────┬───────────────┘
          NÃO                                     SIM
           │                                       │
           ↓                                       ↓
   ┌──────────────┐                   ┌───────────────────────┐
   │ Redireciona  │                   │ STRIPE WEBHOOK:       │
   │ para /planos │                   │ checkout.session      │
   │ (cancelado)  │                   │ .completed            │
   └──────────────┘                   └───────────┬───────────┘
                                                  │
                                                  ↓
                                      ┌───────────────────────┐
                                      │ API: /api/stripe/     │
                                      │      webhook          │
                                      │                       │
                                      │ Valida assinatura     │
                                      │ do webhook            │
                                      └───────────┬───────────┘
                                                  │
                                                  ↓
                                      ┌───────────────────────┐
                                      │ TABELA: users         │
                                      │                       │
                                      │ UPDATE users          │
                                      │ SET                   │
                                      │  subscription_status  │
                                      │    = 'paid',          │
                                      │  subscription_id      │
                                      │    = 'sub_xxx',       │
                                      │  customer_id          │
                                      │    = 'cus_xxx',       │
                                      │  updated_at = NOW()   │
                                      │ WHERE id = user-uuid  │
                                      └───────────┬───────────┘
                                                  │
                                                  ↓
                                      ┌───────────────────────┐
                                      │ Stripe redireciona    │
                                      │ para success_url      │
                                      └───────────┬───────────┘
                                                  │
                                                  ↓
┌─────────────────────────────────────────────────────────────────┐
│              PÁGINA: /planos/sucesso                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                                                         │   │
│  │              ✅ Pagamento Confirmado!                   │   │
│  │                                                         │   │
│  │  🎉 Parabéns! Você agora é PRO!                         │   │
│  │                                                         │   │
│  │  Sua assinatura foi ativada com sucesso.               │   │
│  │                                                         │   │
│  │  Você agora tem acesso a:                               │   │
│  │  ✅ Investimentos ilimitados                            │   │
│  │  ✅ Contato com gestora financeira                      │   │
│  │  ✅ Agendamento de reuniões                             │   │
│  │  ✅ Suporte prioritário                                 │   │
│  │  ✅ Relatórios personalizados                           │   │
│  │                                                         │   │
│  │  [Ir para Dashboard]  [Ver Investimentos]               │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                     AUTHCONTEXT                                 │
│              user.subscriptionStatus = 'paid'                   │
│            (Atualizado automaticamente ou recarregado)          │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                  RECURSOS PRO DESBLOQUEADOS                     │
│                                                                 │
│  • Dashboard: Sem limitações                                    │
│  • Investimentos: Pode adicionar + de 5                         │
│  • Contato: Acesso à página de contato com gestora              │
│  • Perfil: Badge "PRO" exibido                                  │
└─────────────────────────────────────────────────────────────────┘


WEBHOOKS ADICIONAIS PROCESSADOS:

┌─────────────────────────────────────────────────────────────────┐
│           customer.subscription.updated                         │
│                                                                 │
│  Disparado quando:                                              │
│  • Assinatura é renovada mensalmente                            │
│  • Status da assinatura muda                                    │
│                                                                 │
│  Atualiza: subscription_status = 'paid' ou 'free'               │
└─────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────┐
│           customer.subscription.deleted                         │
│                                                                 │
│  Disparado quando:                                              │
│  • Usuário cancela assinatura                                   │
│  • Pagamento falha repetidamente                                │
│                                                                 │
│  Atualiza:                                                      │
│  • subscription_status = 'free'                                 │
│  • subscription_id = null                                       │
│  • Remove acesso aos recursos PRO                               │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📅 FLUXO COMPLETO DE AGENDAMENTO

```
┌─────────────────────────────────────────────────────────────────┐
│                    USUÁRIO                                      │
│                  (Acessa /contato)                              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│              ◆ USUÁRIO AUTENTICADO? ◆                           │
└───────────┬─────────────────────────────────────┬───────────────┘
           NÃO                                    SIM
            │                                      │
            ↓                                      ↓
    ┌──────────────┐                    ┌──────────────────┐
    │ Redireciona  │                    │ Verifica plano   │
    │ para /login  │                    └────────┬─────────┘
    └──────────────┘                             │
                                                 ↓
                                      ┌──────────────────────┐
                                      │ ◆ É USUÁRIO PRO? ◆   │
                                      └──────┬───────────┬───┘
                                            NÃO         SIM
                                             │           │
                                             ↓           ↓
                              ┌──────────────────┐  ┌─────────────┐
                              │ Exibe página     │  │ Carrega     │
                              │ "Recurso PRO"    │  │ agendamentos│
                              │                  │  └──────┬──────┘
                              │ [Ver Planos] 💎  │         │
                              └──────────────────┘         ↓
                                                 ┌──────────────────┐
                                                 │ TABELA:          │
                                                 │ appointments     │
                                                 │                  │
                                                 │ SELECT *         │
                                                 │ WHERE user_id=?  │
                                                 │ ORDER BY         │
                                                 │  created_at DESC │
                                                 └────────┬─────────┘
                                                          │
                                                          ↓
┌─────────────────────────────────────────────────────────────────┐
│                   PÁGINA AGENDAMENTO                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              FORMULÁRIO DE AGENDAMENTO                  │   │
│  │                                                         │   │
│  │  ┌───────────────────────────────────────────────┐     │   │
│  │  │         CALENDÁRIO (react-calendar)           │     │   │
│  │  │                                               │     │   │
│  │  │   DOM SEG TER QUA QUI SEX SAB                 │     │   │
│  │  │                     1   2   3   4             │     │   │
│  │  │    5   6   7   8   9  10  11                 │     │   │
│  │  │   12  13  14  15  16  17  18                 │     │   │
│  │  │   19  20  21  22 [23] 24  25                 │     │   │
│  │  │   26  27  28  29  30  31                     │     │   │
│  │  │                                               │     │   │
│  │  │  minDate: hoje (não permite datas passadas)   │     │   │
│  │  └───────────────────────────────────────────────┘     │   │
│  │                                                         │   │
│  │  Selecione o Horário:                                   │   │
│  │  [09:00] [10:00] [11:00] [14:00]                        │   │
│  │  [15:00] [16:00] [17:00]                                │   │
│  │                                                         │   │
│  │  Telefone (opcional):                                   │   │
│  │  [__________________]                                   │   │
│  │                                                         │   │
│  │  Mensagem *:                                            │   │
│  │  ┌────────────────────────────────────────────┐        │   │
│  │  │ Descreva brevemente o assunto que          │        │   │
│  │  │ gostaria de discutir...                    │        │   │
│  │  │                                            │        │   │
│  │  └────────────────────────────────────────────┘        │   │
│  │                                                         │   │
│  │  [📤 Solicitar Reunião]                                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              SUAS SOLICITAÇÕES                          │   │
│  │                                                         │   │
│  │  ┌──────────────────────────────────────────────┐      │   │
│  │  │ 📅 2024-12-23  15:00     [Pendente]          │      │   │
│  │  │ Gostaria de discutir opções de...           │      │   │
│  │  └──────────────────────────────────────────────┘      │   │
│  │                                                         │   │
│  │  ┌──────────────────────────────────────────────┐      │   │
│  │  │ 📅 2024-11-30  10:00     [Confirmado] ✓      │      │   │
│  │  │ Consultoria sobre diversificação...          │      │   │
│  │  └──────────────────────────────────────────────┘      │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬───────────────────────────────────────────┘
                      │
           (Usuário preenche e clica "Solicitar Reunião")
                      │
                      ↓
┌─────────────────────────────────────────────────────────────────┐
│                  VALIDAÇÃO CLIENT-SIDE                          │
│                                                                 │
│  ◆ Todos os campos obrigatórios preenchidos? ◆                 │
│  • selectedDate: não null                                       │
│  • selectedTime: selecionado                                    │
│  • message: não vazio                                           │
│                                                                 │
│  Se NÃO → alert("Por favor, preencha todos os campos")         │
│  Se SIM → Continua ↓                                            │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│               SUPABASE: Criar Agendamento                       │
│                                                                 │
│  INSERT INTO appointments (                                     │
│    user_id,                                                     │
│    user_email,                                                  │
│    user_name,                                                   │
│    user_phone,                                                  │
│    date,                                                        │
│    time,                                                        │
│    message,                                                     │
│    status                                                       │
│  ) VALUES (                                                     │
│    'user-uuid-123',                                             │
│    'usuario@email.com',                                         │
│    'João Silva',                                                │
│    '(11) 99999-9999',                                           │
│    '2024-12-23',                                                │
│    '15:00',                                                     │
│    'Gostaria de discutir opções de investimento...',           │
│    'pending'                                                    │
│  )                                                              │
└───────────────────────────┬─────────────────────────────────────┘
                            │
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                  ◆ INSERT BEM-SUCEDIDO? ◆                       │
└───────────┬─────────────────────────────────────┬───────────────┘
           NÃO                                    SIM
            │                                      │
            ↓                                      ↓
    ┌──────────────────┐                ┌──────────────────┐
    │ Mostra erro:     │                │ setSuccess(true) │
    │ "Erro ao enviar  │                │                  │
    │ solicitação"     │                │ Limpa campos:    │
    └──────────────────┘                │ • message = ''   │
                                        │ • phone = ''     │
                                        │ • selectedTime=''│
                                        └────────┬─────────┘
                                                 │
                                                 ↓
                                      ┌──────────────────┐
                                      │ loadAppointments()│
                                      │ (Recarrega lista) │
                                      └────────┬─────────┘
                                               │
                                               ↓
┌─────────────────────────────────────────────────────────────────┐
│                   PÁGINA AGENDAMENTO                            │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  ✅ Solicitação enviada com sucesso!                    │   │
│  │  A gestora entrará em contato em breve.                 │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              SUAS SOLICITAÇÕES                          │   │
│  │                                                         │   │
│  │  ┌──────────────────────────────────────────────┐      │   │
│  │  │ 📅 2024-12-23  15:00     [Pendente] 🕐       │      │   │
│  │  │ Gostaria de discutir opções de...   (NOVO!)  │      │   │
│  │  └──────────────────────────────────────────────┘      │   │
│  │                                                         │   │
│  │  ┌──────────────────────────────────────────────┐      │   │
│  │  │ 📅 2024-11-30  10:00     [Confirmado] ✓      │      │   │
│  │  │ Consultoria sobre diversificação...          │      │   │
│  │  └──────────────────────────────────────────────┘      │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │              💡 DICA                                     │   │
│  │  Prepare suas dúvidas com antecedência para             │   │
│  │  aproveitar melhor a reunião com a gestora.             │   │
│  │  Tenha em mãos informações sobre seus                   │   │
│  │  investimentos atuais e objetivos financeiros.          │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────┘


FLUXO BACKEND: Gestão de Status dos Agendamentos

┌─────────────────────────────────────────────────────────────────┐
│              GESTORA (Admin) - Gestão de Agendamentos           │
│                                                                 │
│  A gestora acessa sistema administrativo (não implementado     │
│  na versão atual) e pode:                                       │
│                                                                 │
│  1. Ver todos agendamentos pendentes                            │
│  2. Atualizar status:                                           │
│                                                                 │
│     UPDATE appointments                                         │
│     SET status = 'confirmed'  (ou 'cancelled')                  │
│     WHERE id = 'appointment-uuid'                               │
│                                                                 │
│  3. Usuário verá atualização na próxima vez que acessar /contato│
└─────────────────────────────────────────────────────────────────┘


STATUS POSSÍVEIS DOS AGENDAMENTOS:

┌─────────────────────────────────────────────────────────────────┐
│  🕐 pending    - Aguardando confirmação da gestora              │
│  ✅ confirmed  - Confirmado pela gestora                        │
│  ❌ cancelled  - Cancelado (pela gestora ou usuário)            │
└─────────────────────────────────────────────────────────────────┘


HORÁRIOS DISPONÍVEIS:

┌─────────────────────────────────────────────────────────────────┐
│  AVAILABLE_TIMES = [                                            │
│    '09:00', '10:00', '11:00',                                   │
│    '14:00', '15:00', '16:00', '17:00'                           │
│  ]                                                              │
│                                                                 │
│  Nota: Futura melhoria pode incluir verificação de horários    │
│  já ocupados para evitar conflitos de agendamento.              │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🗂️ DIAGRAMA DE BANCO DE DADOS

```
┌─────────────────────────────────────────────────────────────────┐
│                    SUPABASE DATABASE                            │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │               Schema: auth (Supabase Auth)               │  │
│  │  ┌────────────────────────────────────────────────────┐  │  │
│  │  │  Tabela: users (gerenciada pelo Supabase)          │  │  │
│  │  │  • id (UUID, PK)                                    │  │  │
│  │  │  • email                                            │  │  │
│  │  │  • encrypted_password                               │  │  │
│  │  │  • created_at                                       │  │  │
│  │  └────────────────────────────────────────────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                 │
│                            ↓ (referência)                       │
│                                                                 │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              Schema: public (Aplicação)                  │  │
│  │                                                          │  │
│  │  ┌────────────────────────────────────────────────────┐ │  │
│  │  │  Tabela: users                                     │ │  │
│  │  │  • id (UUID, PK, FK → auth.users.id)               │ │  │
│  │  │  • email (TEXT)                                    │ │  │
│  │  │  • display_name (TEXT)                             │ │  │
│  │  │  • photo_url (TEXT)                                │ │  │
│  │  │  • subscription_status (TEXT)  [free/paid]         │ │  │
│  │  │  • risk_profile (TEXT)  [conservador/moderado/     │ │  │
│  │  │                          arrojado]                  │ │  │
│  │  │  • created_at (TIMESTAMP)                          │ │  │
│  │  │  • updated_at (TIMESTAMP)                          │ │  │
│  │  └────────────────────────────────────────────────────┘ │  │
│  │                                                          │  │
│  │                       ↓ (FK: user_id)                    │  │
│  │                                                          │  │
│  │  ┌────────────────────────────────────────────────────┐ │  │
│  │  │  Tabela: investments                               │ │  │
│  │  │  • id (UUID, PK)                                   │ │  │
│  │  │  • user_id (UUID, FK → users.id)                   │ │  │
│  │  │  • type (TEXT)  [acao/fundo/rendaFixa/cripto]      │ │  │
│  │  │  • ticker (TEXT)                                   │ │  │
│  │  │  • nome (TEXT)                                     │ │  │
│  │  │  • quantidade (NUMERIC)                            │ │  │
│  │  │  • preco_medio (NUMERIC)                           │ │  │
│  │  │  • data_compra (TIMESTAMP)                         │ │  │
│  │  │  • valor_total (NUMERIC)                           │ │  │
│  │  └────────────────────────────────────────────────────┘ │  │
│  │                                                          │  │
│  │                       ↓ (FK: user_id)                    │  │
│  │                                                          │  │
│  │  ┌────────────────────────────────────────────────────┐ │  │
│  │  │  Tabela: appointments                              │ │  │
│  │  │  • id (UUID, PK)                                   │ │  │
│  │  │  • user_id (UUID, FK → users.id)                   │ │  │
│  │  │  • user_email (TEXT)                               │ │  │
│  │  │  • user_name (TEXT)                                │ │  │
│  │  │  • user_phone (TEXT)                               │ │  │
│  │  │  • date (DATE)                                     │ │  │
│  │  │  • time (TEXT)                                     │ │  │
│  │  │  • message (TEXT)                                  │ │  │
│  │  │  • status (TEXT)  [pending/confirmed/cancelled]    │ │  │
│  │  │  • created_at (TIMESTAMP)                          │ │  │
│  │  └────────────────────────────────────────────────────┘ │  │
│  └──────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘

RELACIONAMENTOS:
auth.users (1) ──── (1) public.users
                         │
                         │
                        (1)
                         ├──────────────────┐
                         │                  │
                         ↓                  ↓
                        (N)                (N)
                   investments        appointments
```

---

## 🌐 ARQUITETURA GERAL DA APLICAÇÃO

```
┌─────────────────────────────────────────────────────────────────┐
│                         BROWSER                                 │
│                     (Cliente / Usuário)                         │
└───────────────────────────┬─────────────────────────────────────┘
                            │ HTTPS
                            ↓
┌─────────────────────────────────────────────────────────────────┐
│                      NEXT.JS APPLICATION                        │
│                      (Frontend + Backend)                       │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │                 CLIENT SIDE (Browser)                   │   │
│  │                                                         │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │              PÁGINAS (React)                    │   │   │
│  │  │  • /login        • /dashboard                   │   │   │
│  │  │  • /investimentos • /dividendos                 │   │   │
│  │  │  • /perfil       • /planos                      │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                        ↕                                │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │           CONTEXT (Estado Global)               │   │   │
│  │  │  • AuthContext (user, signIn, signUp, etc.)     │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  │                        ↕                                │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │          COMPONENTES (Reutilizáveis)            │   │   │
│  │  │  • MainLayout  • Cards  • Loading               │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│                            ↕ API Calls                          │
│                                                                 │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │               SERVER SIDE (Node.js)                     │   │
│  │                                                         │   │
│  │  ┌─────────────────────────────────────────────────┐   │   │
│  │  │              API ROUTES                         │   │   │
│  │  │  • /api/quotes/[ticker]                         │   │   │
│  │  │  • /api/dividends/[ticker]                      │   │   │
│  │  │  • /api/news                                    │   │   │
│  │  │  • /api/stripe/*                                │   │   │
│  │  └─────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────┘   │
└─────────────────────┬─────────────────────┬─────────────────────┘
                      │                     │
                      │                     │
                      ↓                     ↓
┌──────────────────────────────┐  ┌─────────────────────────┐
│     SUPABASE BACKEND         │  │    BRAPI API            │
│                              │  │   (API Externa)         │
│  ┌────────────────────────┐  │  │                         │
│  │  Supabase Auth         │  │  │  • Cotações de ações    │
│  │  • signIn()            │  │  │  • Lista de ações       │
│  │  • signUp()            │  │  │  • Dividendos           │
│  │  • getSession()        │  │  │                         │
│  └────────────────────────┘  │  └─────────────────────────┘
│                              │
│  ┌────────────────────────┐  │
│  │  Supabase Database     │  │
│  │  • Tabela: users       │  │
│  │  • Tabela: investments
   │  • Tabela: agendamentos
│  └────────────────────────┘  │
└──────────────────────────────┘
```

---

## 🔄 FLUXO DE DADOS COMPLETO (Visão Geral)

```
                                    USUÁRIO
                                      │
                                      │ Acessa aplicação
                                      ↓
                               ┌─────────────┐
                               │    LOGIN    │
                               │   /login    │
                               └──────┬──────┘
                                      │
                                      │ Autentica
                                      ↓
                        ┌─────────────────────────────┐
                        │       SUPABASE AUTH         │
                        │  signIn() / signUp()        │
                        └──────────────┬──────────────┘
                                       │
                                       │ Valida/Cria usuário
                                       ↓
                        ┌─────────────────────────────┐
                        │      TABELA: users          │
                        │  id, email, display_name,   │
                        │  subscription_status,       │
                        │  risk_profile               │
                        └──────────────┬──────────────┘
                                       │
                                       │ Redireciona (autenticado)
                                       ↓
    ┌──────────────────────────────────────────────────────────────────────────────┐
    │                              MAINLAYOUT                                       │
    │                         (Menu de Navegação)                                   │
    └───┬───────────┬───────────┬───────────┬───────────┬───────────┬─────────────┘
        │           │           │           │           │           │
        ↓           ↓           ↓           ↓           ↓           ↓
   ┌─────────┐ ┌──────────┐ ┌────────┐ ┌─────────┐ ┌────────┐ ┌─────────┐
   │DASHBOARD│ │INVESTIR  │ │DIVIDENDOS│ │ PERFIL  │ │NOTÍCIAS│ │ PLANOS  │
   │    📊   │ │    💼    │ │   💰   │ │   👤    │ │   📰   │ │   💎    │
   └────┬────┘ └────┬─────┘ └────┬───┘ └────┬────┘ └────┬───┘ └────┬────┘
        │           │            │          │           │          │
        │           │            │          │           │          │
        ↓           ↓            ↓          ↓           ↓          ↓
┌───────────────────────────────────────────────────────────────────────────────────┐
│                          SUPABASE DATABASE                                        │
│  ┌──────────────┐     ┌──────────────┐     ┌──────────────┐                      │
│  │    users     │     │ investments  │     │ appointments │                      │
│  └──────────────┘     └──────────────┘     └──────────────┘                      │
└──────────┬─────────────────┬──────────────────────┬───────────────────────────────┘
           │                 │                      │
           │                 │                      │
           ↓                 ↓                      │
┌─────────────────────────────────────────┐        │
│            APIS EXTERNAS                │        │
│  ┌──────────────────────────────────┐  │        │
│  │           BRAPI API              │  │        │
│  │  • Cotações de ações             │  │        │
│  │  • Lista de ativos               │  │        │
│  │  • Dados de dividendos           │  │        │
│  └──────────────────────────────────┘  │        │
│                                         │        │
│  ┌──────────────────────────────────┐  │        │
│  │         RSS FEEDS                │  │        │
│  │  • InfoMoney - Mercados          │  │        │
│  │  • InfoMoney - Investimentos     │  │        │
│  │  • Valor Econômico - Finanças    │  │        │
│  └──────────────────────────────────┘  │        │
│                                         │        │
│  ┌──────────────────────────────────┐  │        │
│  │           STRIPE API             │←─┼────────┘
│  │  • Checkout Sessions             │  │
│  │  • Customers                     │  │
│  │  • Subscriptions                 │  │
│  │  • Webhooks                      │  │
│  └──────────────────────────────────┘  │
└─────────────────────────────────────────┘
```

---

## 📊 MAPA DE ROTAS E FUNCIONALIDADES

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                         ESTRUTURA DE PÁGINAS                                     │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  PÚBLICAS (sem auth)           PROTEGIDAS (requer auth)                         │
│  ┌──────────────────┐          ┌──────────────────────────────────────────┐     │
│  │  /login          │          │  /dashboard     - Resumo da carteira     │     │
│  │  (Única página   │          │  /investimentos - Explorar ativos        │     │
│  │   sem login)     │          │  /dividendos    - Histórico dividendos   │     │
│  └──────────────────┘          │  /perfil        - Quiz de perfil         │     │
│                                │  /noticias      - Feed de notícias       │     │
│                                │  /planos        - Assinatura PRO         │     │
│                                │  /contato       - Agendamento (PRO only) │     │
│                                └──────────────────────────────────────────┘     │
│                                                                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│  API ROUTES (Backend Next.js)                                                    │
│  ┌──────────────────────────────────────────────────────────────────────────┐   │
│  │  /api/quotes/[ticker]             → BRAPI: Cotação atual do ativo        │   │
│  │  /api/dividends/[ticker]          → BRAPI: Histórico de dividendos       │   │
│  │  /api/news                        → RSS: Notícias filtradas             │   │
│  │  /api/stripe/create-checkout-session → Stripe: Criar checkout          │   │
│  │  /api/stripe/webhook              → Stripe: Processar eventos           │   │
│  │  /api/stripe/cancel-subscription  → Stripe: Cancelar assinatura         │   │
│  │  /api/stripe/check-payment        → Stripe: Verificar pagamento         │   │
│  └──────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🔐 FLUXO DE PERMISSÕES

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                      CONTROLE DE ACESSO POR PLANO                               │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   PLANO GRATUITO (subscription_status = 'free')                                 │
│   ┌──────────────────────────────────────────────────────────────────────────┐  │
│   │  ✅ Dashboard com visão geral                                            │  │
│   │  ✅ Explorar investimentos                                               │  │
│   │  ✅ Quiz de perfil do investidor                                         │  │
│   │  ✅ Notícias do mercado                                                   │  │
│   │  ✅ Histórico de dividendos                                               │  │
│   │  ⚠️  Máximo 5 investimentos ativos                                       │  │
│   │  ❌ Contato com gestora                                                   │  │
│   │  ❌ Agendamento de reuniões                                               │  │
│   │  ❌ Suporte prioritário                                                   │  │
│   └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│   PLANO PRO (subscription_status = 'paid') - R$ 29,90/mês                       │
│   ┌──────────────────────────────────────────────────────────────────────────┐  │
│   │  ✅ Tudo do plano gratuito                                               │  │
│   │  ✅ Investimentos ilimitados                                              │  │
│   │  ✅ Contato direto com gestora financeira                                │  │
│   │  ✅ Agendamento de reuniões                                               │  │
│   │  ✅ Suporte prioritário                                                   │  │
│   │  ✅ Relatórios personalizados                                             │  │
│   └──────────────────────────────────────────────────────────────────────────┘  │
│                                                                                  │
│                                                                                  │
│   FLUXO DE VERIFICAÇÃO:                                                          │
│                                                                                  │
│   ┌───────────┐    ┌─────────────────┐    ┌─────────────────────────────────┐   │
│   │ Usuário   │───→│ user.           │───→│ 'paid' → Acesso total          │   │
│   │ acessa    │    │ subscriptionStatus│   │ 'free' → Acesso limitado       │   │
│   │ /contato  │    └─────────────────┘    └─────────────────────────────────┘   │
│   └───────────┘                                                                  │
│        │                                                                         │
│        ↓                                                                         │
│   ┌───────────────────────────────────────────────────────────────────────┐     │
│   │  if (user.subscriptionStatus !== 'paid') {                            │     │
│   │    return <RecursoPRO />;  // Mostra página para upgrade             │     │
│   │  }                                                                    │     │
│   │  return <FormularioAgendamento />;  // Mostra formulário             │     │
│   └───────────────────────────────────────────────────────────────────────┘     │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🏗️ FLUXO DE PERFIL DE INVESTIDOR

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                    PERFIS E INVESTIMENTOS PERMITIDOS                            │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │                    QUIZ DE PERFIL (5 perguntas)                         │   │
│   │                                                                         │   │
│   │  Resposta A = 1 ponto    Resposta B = 2 pontos    Resposta C = 3 pontos │   │
│   │                                                                         │   │
│   │  Média final:                                                           │   │
│   │  ≤ 1.5      → CONSERVADOR                                               │   │
│   │  1.5 - 2.5  → MODERADO                                                  │   │
│   │  > 2.5      → ARROJADO                                                  │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
│   INVESTIMENTOS POR PERFIL:                                                      │
│                                                                                  │
│   ┌───────────────┐   ┌───────────────┐   ┌───────────────┐                    │
│   │  CONSERVADOR  │   │   MODERADO    │   │   ARROJADO    │                    │
│   │    🛡️         │   │     ⚖️       │   │     🚀        │                    │
│   ├───────────────┤   ├───────────────┤   ├───────────────┤                    │
│   │ ✅ Renda Fixa │   │ ✅ Renda Fixa │   │ ✅ Renda Fixa │                    │
│   │ ❌ Fundos     │   │ ✅ Fundos     │   │ ✅ Fundos     │                    │
│   │ ❌ Ações      │   │ ✅ Ações      │   │ ✅ Ações      │                    │
│   │ ❌ Cripto     │   │ ❌ Cripto     │   │ ✅ Cripto     │                    │
│   └───────────────┘   └───────────────┘   └───────────────┘                    │
│                                                                                  │
│   FUNÇÃO: getAvailableInvestmentTypes(profile)                                   │
│   ┌─────────────────────────────────────────────────────────────────────────┐   │
│   │  'conservador' → ['rendaFixa']                                          │   │
│   │  'moderado'    → ['rendaFixa', 'fundo', 'acao']                         │   │
│   │  'arrojado'    → ['rendaFixa', 'fundo', 'acao', 'cripto']               │   │
│   └─────────────────────────────────────────────────────────────────────────┘   │
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

---

## 🔄 CICLO DE VIDA DO USUÁRIO NA APLICAÇÃO

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                        JORNADA COMPLETA DO USUÁRIO                              │
└─────────────────────────────────────────────────────────────────────────────────┘

     ┌──────────────────────────────────────────────────────────────────────────┐
     │                        1. PRIMEIRO ACESSO                                │
     └───────────────────────────────┬──────────────────────────────────────────┘
                                     │
                                     ↓
                      ┌──────────────────────────────┐
                      │  /login - Criar Conta        │
                      │  (signUp com email/senha)    │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
                      ┌──────────────────────────────┐
                      │  Supabase cria auth.user     │
                      │  + public.users              │
                      │  subscription_status='free'  │
                      │  risk_profile = null         │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
     ┌──────────────────────────────────────────────────────────────────────────┐
     │                        2. DEFINIR PERFIL                                 │
     └───────────────────────────────┬──────────────────────────────────────────┘
                                     │
                                     ↓
                      ┌──────────────────────────────┐
                      │  /perfil - Quiz 5 perguntas  │
                      │  Calcula: conservador/       │
                      │  moderado/arrojado           │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
                      ┌──────────────────────────────┐
                      │  UPDATE users                │
                      │  SET risk_profile='moderado' │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
     ┌──────────────────────────────────────────────────────────────────────────┐
     │                        3. EXPLORAR E INVESTIR                            │
     └───────────────────────────────┬──────────────────────────────────────────┘
                                     │
            ┌────────────────────────┼────────────────────────┐
            │                        │                        │
            ↓                        ↓                        ↓
┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐
│ /investimentos    │  │ /dashboard        │  │ /dividendos       │
│                   │  │                   │  │                   │
│ • Ver ativos      │  │ • Ver carteira    │  │ • Ver dividendos  │
│ • Filtrar perfil  │  │ • Lucro/prejuízo  │  │ • Total recebido  │
│ • Investir        │  │ • Gráficos        │  │ • Histórico       │
└─────────┬─────────┘  └───────────────────┘  └───────────────────┘
          │
          ↓
┌───────────────────┐
│ INSERT investment │
│ (até 5 se FREE)   │
└───────────────────┘
          │
          ↓
     ┌──────────────────────────────────────────────────────────────────────────┐
     │                    4. ACOMPANHAR MERCADO                                 │
     └───────────────────────────────┬──────────────────────────────────────────┘
                                     │
                                     ↓
                      ┌──────────────────────────────┐
                      │  /noticias                   │
                      │                              │
                      │  • RSS InfoMoney             │
                      │  • RSS Valor Econômico       │
                      │  • Filtro automático         │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
     ┌──────────────────────────────────────────────────────────────────────────┐
     │                        5. UPGRADE PARA PRO                               │
     └───────────────────────────────┬──────────────────────────────────────────┘
                                     │
                                     ↓
                      ┌──────────────────────────────┐
                      │  /planos - Escolher PRO      │
                      │  [Assinar R$ 29,90/mês]      │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
                      ┌──────────────────────────────┐
                      │  Stripe Checkout             │
                      │  Pagamento com cartão        │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
                      ┌──────────────────────────────┐
                      │  Webhook: checkout.completed │
                      │  UPDATE subscription_status  │
                      │  = 'paid'                    │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
     ┌──────────────────────────────────────────────────────────────────────────┐
     │                     6. RECURSOS PRO LIBERADOS                            │
     └───────────────────────────────┬──────────────────────────────────────────┘
                                     │
            ┌────────────────────────┼────────────────────────┐
            │                        │                        │
            ↓                        ↓                        ↓
┌───────────────────┐  ┌───────────────────┐  ┌───────────────────┐
│ Investimentos     │  │ /contato          │  │ Suporte           │
│ ILIMITADOS        │  │                   │  │ PRIORITÁRIO       │
│                   │  │ • Calendário      │  │                   │
│ Sem limite de 5   │  │ • Agendar reunião │  │ Resposta rápida   │
│ investimentos     │  │ • Falar com       │  │ da equipe         │
│                   │  │   gestora         │  │                   │
└───────────────────┘  └─────────┬─────────┘  └───────────────────┘
                                 │
                                 ↓
                      ┌──────────────────────────────┐
                      │  INSERT appointment          │
                      │  status = 'pending'          │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
                      ┌──────────────────────────────┐
                      │  Gestora confirma            │
                      │  status = 'confirmed'        │
                      └───────────────┬──────────────┘
                                      │
                                      ↓
                      ┌──────────────────────────────┐
                      │  Reunião realizada!          │
                      │  Consultoria personalizada   │
                      └──────────────────────────────┘
```

---

**FIM DOS DIAGRAMAS ASCII**

Use estes diagramas como referência para criar seu desenho no Excalidraw!


